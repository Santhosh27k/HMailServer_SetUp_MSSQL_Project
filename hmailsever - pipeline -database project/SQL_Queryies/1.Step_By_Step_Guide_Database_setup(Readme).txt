<!-- ================================================================
  Project     : hMailServer SQL Database Setup - Step-by-Step Guide
  Author      : Santhosh
  GitHub      : https://github.com/Santhosh27k
  LinkedIn    : https://www.linkedin.com/in/santhosh-s-219287228
  Description : Step-by-step SQL scripts and notes to install, remove,
                and manage an hMailServer instance using Microsoft SQL Server.
  Files       : 1_Main_Script_Prerequisites.sql
                2_Main_find_and_delete_that_SQL_login.sql
                3_Main_Create_Login_Database.sql
                4_Main_Create_Table.sql
                5_Alter_Role_Sysadmin.sql
                6_Change_Password.sql
                7_Alter_Name_on_different_levels.sql
  Usage       : Read carefully. Steps 1-2 are optional cleanup steps.
  Version     : 1.0
  Date        : 2025-11-05
  License     : MIT (or choose your preferred license)
================================================================ -->


============================================================
hMailServer SQL Project ‚Äî Step-by-Step Execution Guide
============================================================

This document explains how to execute the SQL scripts in the correct order to
set up (or reset) your hMailServer SQL Database environment.

------------------------------------------------------------
üìÅ FILE ORDER AND PURPOSE
------------------------------------------------------------

1Ô∏è‚É£  1_Main_Script_Prerequisites.sql
------------------------------------------------------------
Purpose:
    - Clean up any existing hMailServer setup.
    - Drops all constraints, indexes, tables, and finally the database itself.
    - Can also drop the associated SQL login if defined.
When to Run:
    - ONLY if you already have a previous hMailServer database setup
      and want to completely remove it before reinstalling or rebuilding.
Important:
    - Script is safe by default and runs in preview mode.
      Set @ConfirmDrop = 1 to actually execute deletions.
Notes:
    - This is an optional cleanup step (Step 1).

------------------------------------------------------------

2Ô∏è‚É£  2_Main_find_and_delete_that_SQL_login.sql
------------------------------------------------------------
Purpose:
    - Finds and deletes SQL Server logins related to a previous hMailServer setup.
    - Useful if an old login (e.g., ‚Äúhmailuser‚Äù) remains even after the database was dropped.
    - Prevents login conflicts when recreating the hMailServer database and user.
When to Run:
    - ONLY if a previous installation existed and you are performing a clean reinstallation.
    - Run this script after Step 1 (Prerequisites) and before creating the new login/database.
What It Does:
    - Searches for any login with names containing ‚Äúhmail‚Äù or related keywords.
    - Displays matching logins.
    - Offers a controlled way to drop those logins safely.
Notes:
    - This is an optional cleanup step (Step 2).
    - Always confirm the login name before deleting.

------------------------------------------------------------

3Ô∏è‚É£  3_Main_Create_Login_Database.sql
------------------------------------------------------------
Purpose:
    - Creates a new SQL LOGIN and PASSWORD in the master database.
    - Creates the hMailServer database (e.g., hMailServerDB).
    - Maps the login to a database user inside the hMailServer database.
    - Grants the user the `db_owner` role for full access.
When to Run:
    - Always run this script after cleanup (if performed) to initialize a new setup.

------------------------------------------------------------

4Ô∏è‚É£  4_Main_Create_Table.sql
------------------------------------------------------------
Purpose:
    - Creates all necessary tables for the hMailServer schema.
    - Adds constraints (Primary Keys, Foreign Keys, Unique Keys).
    - Creates indexes for performance optimization.
When to Run:
    - After the database and user have been successfully created.
Notes:
    - Run this script while connected to the `hMailServerDB` database.
    - Use the official schema or customize based on your configuration.

------------------------------------------------------------

5Ô∏è‚É£  5_Alter_Role_Sysadmin.sql
------------------------------------------------------------
Purpose:
    - Demonstrates how to promote a SQL login to higher server-level roles.
    - Shows examples for adding or removing a login from:
         ‚Ä¢ `sysadmin` (server-level)
         ‚Ä¢ `db_owner` (database-level)
When to Run:
    - Optional ‚Äî use only if you need to grant or revoke administrative privileges.

------------------------------------------------------------

6Ô∏è‚É£  6_Change_Password.sql
------------------------------------------------------------
Purpose:
    - Changes the SQL login password for your hMailServer login.
    - Supports forcing policy checks and password expiration options.
When to Run:
    - Anytime you want to change or enforce stronger security credentials.

------------------------------------------------------------

7Ô∏è‚É£  7_Alter_Name_on_different_levels.sql
------------------------------------------------------------
Purpose:
    - Demonstrates how to rename a login or database user.
    - Allows remapping a renamed user to a different SQL login.
When to Run:
    - Optional ‚Äî use when renaming users or restructuring accounts.

------------------------------------------------------------
‚öôÔ∏è RECOMMENDED EXECUTION FLOW
------------------------------------------------------------

   ‚ö†Ô∏è Optional Cleanup Steps (only if an old hMailServer setup exists):
      Step 1 ‚Üí Run: 1_Main_Script_Prerequisites.sql
      Step 2 ‚Üí Run: 2_Main_find_and_delete_that_SQL_login.sql

   üß± New Installation Steps:
      Step 3 ‚Üí Run: 3_Main_Create_Login_Database.sql
      Step 4 ‚Üí Run: 4_Main_Create_Table.sql

   üîß Optional Administrative Scripts:
      Step 5 ‚Üí Run: 5_Alter_Role_Sysadmin.sql
      Step 6 ‚Üí Run: 6_Change_Password.sql
      Step 7 ‚Üí Run: 7_Alter_Name_on_different_levels.sql

------------------------------------------------------------
üß† NOTES & BEST PRACTICES
------------------------------------------------------------
‚Ä¢ Always take backups before dropping or altering any database or login.
‚Ä¢ Use `PRINT` messages and preview flags to confirm expected results.
‚Ä¢ Run these scripts from SQL Server Management Studio (SSMS)
  using an account with sufficient privileges.
‚Ä¢ Confirm each step completes successfully before proceeding to the next.
‚Ä¢ Never modify the master database directly unless absolutely necessary.

------------------------------------------------------------
End of File
------------------------------------------------------------





